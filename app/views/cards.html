<div ng-controller="CardsCtrl"
    tabindex="0"
    ui-keydown="{
      'esc'  : 'deselectCard()',
      'left' : 'previousCard()',
      'right': 'nextCard()'
    }"
    style="outline: none !important;">
  <nr-cards-view
      class="cards"
      query-result="queryResult"
      selection="selectedCard"
      zoom="grid.zoom">

    <!-- SELECTED CARD -->
    <div ng-if="selectedCard != null"
         class="selected-card-container">
      <div class="selected-card">
        <h2 class="{{selectedCard.faction.toLowerCase()}}">
          {{selectedCard.title}}
        </h2>
        <div class="info">
          <h3>Related Cards</h3>

          <h3>Links</h3>
          <ul class="list-unstyled">
            <li>
              <a href="{{selectedCard.cgdb_url}}#commentsStart" target="cgdb"><i class="icon-link-ext"></i> Comments on CardGameDB</a>
            </li>
            <li>
              <a href="{{selectedCard.nrdb_url}}" target="nrdb"><i class="icon-link-strength"></i> View on NetrunnerDB</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- HEADERS -->
    <h2 ng-repeat="(id, group) in queryResult.groups track by id"
        grid-id="{{group.id}}"
        class="{{group.id}} grid-header"
        title="{{group.id}}">
      <small class="card-count"><ng-pluralize
          count="group.cards.length"
          when="{
            '1': '1 card',
            'other': '{} cards'
          }"></ng-pluralize>
      </small>
      {{group.title|primaryGroupTitle:filter.groupings}}
      <small class="secondary-group">{{group.title|secondaryGroupTitle:filter.groupings}}</small>
    </h2>

    <!--
      CARDS

      Note:
      For performance reasons, this template is bound once, with all the cards, then never touched
      again. All sorting and show/hide logic for cards exists in the nr-cards-view directive.
    -->
    <div ng-repeat="card in cards track by card.id"
         bindonce
         class="grid-item"
         ng-click="selectCard(card)"
         bo-attr-grid-id="card.id"
         bo-attr>
      <img bo-src="card.imagesrc" bo-title="card.title">
      <div class="background"></div>
    </div>
  </nr-cards-view>
</div>
