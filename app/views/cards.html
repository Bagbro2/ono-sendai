<div ng-controller="CardsCtrl"
    tabindex="0"
    ui-keydown="{
      'esc'  : 'deselectCard()',
      'left' : 'previousCard()',
      'right': 'nextCard()'
    }">
  <nr-cards-view
      class="cards"
      query-result="queryResult"
      selected-card="selectedCard"
      zoom="grid.zoom">
    <!-- HEADERS -->
    <h2 ng-repeat="(id, group) in queryResult.groups track by id"
        grid-id="{{group.id}}"
        class="{{group.id}} grid-header"
        title="{{group.id}}">
      <small class="card-count"><ng-pluralize
          count="group.cards.length"
          when="{
            '1': '1 card',
            'other': '{} cards'
          }"></ng-pluralize>
      </small>
      {{group.title|primaryGroupTitle:filter.groupings}}
      <small class="secondary-group">{{group.title|secondaryGroupTitle:filter.groupings}}</small>
    </h2>

    <!--
      CARDS

      Note:
      This template is bound once, with all the cards, then never touched again. All
      sorting and show/hide logic for cards exists in nr-cards-view.
    -->
    <img ng-repeat="card in cards track by card.id"
         bindonce
         class="grid-item"
         bo-src="card.imagesrc"
         ng-click="selectCard(card)"
         bo-title="card.title"
         bo-attr-grid-id="card.id"
         bo-attr>
  </nr-cards-view>
</div>
